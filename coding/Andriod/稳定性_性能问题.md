# 稳定性 专题

例子：AS  attach 系统进程，系统直接重启

分析：

## 稳定性问题

问题

# 性能专题

## 疑问

TODO: 如何被认定为性能问题？标准是啥？谁来定？

| wew  | wewe | weewe | ewewe | eweweewewwewe |
| ---- | ---- | ----- | ----- | ------------- |
|      |      |       |       |               |
|      |      |       |       |               |
|      |      |       |       |               |





## 性能问题之咸鱼上位（优先级反转问题）

例子：

> A线程的优先级高，B线程优先级低，但是B线程先拿到了锁。此时，其他线程（进程？）（自然比B线程优先级高）会占用cpu时间多。
>
> -------------->  即：B  cpu执行分配时间少，执行时间长。导致A高优先级，迟迟拿不到锁，一直等待



总之，场景：

> -<font color='red'>优先级低的</font>，<font color='red'>反而先执行</font> 或者 <font color='red'>分配时间多</font>    （原因：因为1、先持有锁、 2、）
>
> -------->即，<font color='red'>咸鱼上位</font>

 办法：

> 在虚拟机里，把当前持锁的进程优先级提高，占用cpu就高，很快运行完。。。然后外面高优先级的，拿到锁
>
> 为啥是虚拟机做？因为锁  +  控制优先级 都在虚拟机里 



再举例子：

> Binder的优先级反转  TODO

### 时间优化一：让空闲的人（进程）提前做事

如何快速启动？针对于高频应用，在bindapplication时，甚至`开始startActivity时，就把surface创建起来`

背后的方法论：

> <font color='red'>让空闲的人提前做事。</font>上述优化，即：妻子炒菜，丈夫去买菜------>  优化，妻子提前把炒菜的承载 锅 刷好
>
> 关键词：1、空闲    2、提前

观测工具：

> trace？

### 时间优化二： 多养鱼思想

线程池、对象池  --------> 虽然没用到，但是早早地**养起来**

好处：内存不会突然增长；复用思想；**快速，拿来就用**

其他例子：

更高频应用，<font color='red'>没有startactivity</font>，也创建一个surface，然后进程冷冻  ------->  等真正要用的时候，解冻



养鱼 和  提前做 思想的**区别在于**：

> 提前做只是提前，一定会用得到；
>
> 养鱼，很可能用不到



#### 进程冷冻 引起的问题

------>  TODO: 挪到其他章节

冷冻容易，解冻需要考虑的多。比如，冷冻过程，有tranction过来怎么办？Binder的同步调用怎么办？

### 参考：

https://zhuanlan.zhihu.com/p/348548041



#    TODO: 一些基本问题

如何衡量-----> status?

如何实现？



# 关键词大收集

查看displayid：   在display dump中，搜 mDisplayid

#  抛开性能优化

抛开性能优化来看：

> 程序的<font color='red'>性能优化的思想，来源于生活。无一例外。</font>     ----> 所以，记录生活的美好，不问用处
>
> 好的程序思想  -------->  应用于生活
>
> 好的生活中思想 -------> 应用于程序

